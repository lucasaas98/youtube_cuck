<!DOCTYPE html>
<html lang="en">
    <head>
        <meta content="text/html;charset=utf-8" http-equiv="Content-Type" />
        <meta content="utf-8" http-equiv="encoding" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Youtube Cuck - Playlists</title>
        <meta name="description" content="Bootleg Garbagio Youtube" />
        <meta name="author" content="Repi Gamer" />
        <link rel="shortcut icon" href="../static/favicon.ico" />
        <link rel="stylesheet" href="../static/base.css" />
        <link rel="stylesheet" href="../static/playlist.css" />
    </head>
    <body>
        <ul class="nav_bar">
            <button class="hamburger" id="hamburger-menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <div class="nav-menu" id="nav-menu">
                <li>
                    <a href="../">Home</a>
                </li>
                <li>
                    <a href="../shorts">Shorts</a>
                </li>
                <li>
                    <a href="../most_recent_video">Continue</a>
                </li>
                <li>
                    <a href="../most_recent_videos">History</a>
                </li>
                <li>
                    <a href="../subs">Subscriptions</a>
                </li>
                <li>
                    <a class="active" href="../playlist">Playlists</a>
                </li>
                <li>
                    <a {% if request.url.path.endswith('downloads') %}class="active"{% endif %}
                       href="../downloads">Downloads</a>
                </li>
                <li class="right">
                    <a id="add">Add Channel</a>
                </li>
            </div>
        </ul>
        <div class="main-content">
            <h1>My Playlists</h1>
            <!-- Create new playlist section -->
            <div class="create-playlist-section">
                <h2>Create New Playlist</h2>
                <p>Or</p>
                ganize your favorite videos into custom playlists
            </p>
            <button id="add" class="btn btn-success">+ Create Playlist</button>
        </div>
        {% if data %}
            <div class="playlist-grid">
                {% for row in data %}
                    <div class="playlist-card">
                        <a href="/playlist/{{ row[0] }}" class="playlist-name">{{ row[0] }}</a>
                        <div class="playlist-actions">
                            <a href="/playlist/{{ row[0] }}" class="btn btn-primary">View</a>
                            <button onclick="deletePlaylist('{{ row[0] }}')" class="btn btn-danger">Delete</button>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="empty-state">
                <h2>No Playlists Yet</h2>
                <p>Create your first playlist to start organizing your videos</p>
                <button onclick="document.getElementById('add').click()"
                        class="btn btn-success">Get Started</button>
            </div>
        {% endif %}
        <!-- Create Playlist Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h3>Create New Playlist</h3>
                <form id="playlist_form">
                    <div class="form-group">
                        <label for="playlist_name" class="form-label">Playlist name</label>
                        <input type="text"
                               id="playlist_name"
                               name="playlist_name"
                               class="form-input"
                               placeholder="Enter playlist name"
                               required
                               autocomplete="off" />
                    </div>
                    <button type="submit" class="btn btn-success">Create Playlist</button>
                </form>
            </div>
        </div>
    </div>
    <script>
        // Get the modal
        var modal = document.getElementById("myModal");

        // Get the button that opens the modal
        var btn = document.getElementById("add");

        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];

        // When the user clicks on the button, open the modal
        add.onclick = function() {
            modal.style.display = "block";
        };

        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
            modal.style.display = "none";
        };

        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        };

        function formSubmit(event) {
            var url = "../playlist/create";
            var request = new XMLHttpRequest();
            request.open("POST", url, true);
            request.onload = function() {
                // request successful
                var jsonResponse = JSON.parse(request.responseText);
                alert(jsonResponse.text);
                modal.style.display = "none";
                location.reload(); // Refresh the page to show the new playlist
            };

            request.onerror = function() {
                alert("There was an error creating the playlist.");
            };

            request.send(new FormData(event.target)); // create FormData from form that triggered event
            event.preventDefault();
        }

        function deletePlaylist(playlistName) {
            if (
                confirm(
                    "Are you sure you want to delete the playlist '" +
                    playlistName +
                    "'?",
                )
            ) {
                var url =
                    "../playlist/" +
                    encodeURIComponent(playlistName) +
                    "/delete";
                var request = new XMLHttpRequest();
                request.open("POST", url, true);
                request.onload = function() {
                    var jsonResponse = JSON.parse(request.responseText);
                    alert(jsonResponse.text);
                    location.reload(); // Refresh the page
                };
                request.onerror = function() {
                    alert("There was an error deleting the playlist.");
                };
                request.send();
            }
        }

        // and you can attach form submit event like this for example
        function attachFormSubmitEvent(formId) {
            document
                .getElementById(formId)
                .addEventListener("submit", formSubmit);
        }

        attachFormSubmitEvent("playlist_form");
    </script>
    <script src="../static/hamburger_menu.js"></script>
    <script src="../static/keyboard_controls.js"></script>
</body>
</html>
