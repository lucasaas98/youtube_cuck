<!DOCTYPE html>
<html lang="en">
    <head>
        <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
        <meta content="utf-8" http-equiv="encoding">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Youtube Cuck</title>
        <meta name="description" content="Bootleg Garbagio Youtube">
        <meta name="author" content="Repi Gamer">
        <link rel="shortcut icon" href="../static/favicon.ico">
        <link rel="stylesheet" href="../static/base.css">
        <link rel="stylesheet" href="../static/yt_cuck.css">
        {% for row in data[0] %}
        <link rel="preload" as="video" href="/videos/{{ row['vid_path'] }}" type="video/mp4" />
        {% endfor %}
    </head>
    <body>
        <ul class="nav_bar">
            <button class="hamburger" id="hamburger-menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <div class="nav-menu" id="nav-menu">
                <li>
                    <a {% if request.url.path.endswith('/') %}class="active"{% endif %}
                       href="/">Home</a>
                </li>
                <li>
                    <a {% if request.url.path.endswith('shorts') %}class="active"{% endif %}
                       href="shorts">Shorts</a>
                </li>
                <li>
                    <a {% if request.url.path.endswith('most_recent_video') %}class="active"{% endif %}
                       href="most_recent_video">Continue</a>
                </li>
                <li>
                    <a {% if request.url.path.endswith('most_recent_videos') %}class="active"{% endif %}
                       href="most_recent_videos">History</a>
                </li>
                <li>
                    <a {% if request.url.path.endswith('subs') %}class="active"{% endif %}
                       href="subs">Subscriptions</a>
                </li>
                <li>
                    <a {% if request.url.path.endswith('playlist') %}class="active"{% endif %}
                       href="playlist">Playlists</a>
                </li>
                <li>
                    <a {% if request.url.path.endswith('downloads') %}class="active"{% endif %}
                       href="downloads">Downloads</a>
                </li>
                <li class="right">
                    <a id="add">Add Channel</a>
                </li>
                {% if data[4] %}
                    <li>
                        <a id="rss_ref" class="active" onclick="refresh_rss()">Last Refresh - {{ data[2] }} -> {{ data[3] }}</a>
                    </li>
                {% else %}
                    <li>
                        <a id="rss_ref" onclick="refresh_rss()">Last Refresh - {{ data[2] }}</a>
                    </li>
                {% endif %}
            </div>
        </ul>
        <!-- Search and Filter Controls -->
        <div class="filter-controls">
            <button class="filter-toggle-btn" id="filter-toggle">
                <span class="filter-toggle-icon">üîç</span>
                <span class="filter-toggle-text">Search & Filters</span>
                <span class="filter-toggle-arrow">‚ñº</span>
            </button>
            <div class="filter-content" id="filter-content">
                <div class="search-section">
                    <input type="text"
                           id="search-input"
                           placeholder="Search videos, descriptions, or channels..."
                           value="{{ filters.search }}"
                           class="search-input">
                    <button id="search-btn" class="search-btn">Search</button>
                    <button id="clear-search-btn" class="clear-btn">Clear</button>
                </div>
                <div class="filter-section">
                    <select id="sort-by" class="filter-select">
                        <option value="downloaded_at"
                                {% if filters.sort_by == 'downloaded_at' %}selected{% endif %}>
                            Sort by Download Date
                        </option>
                        <option value="pub_date"
                                {% if filters.sort_by == 'pub_date' %}selected{% endif %}>Sort by Upload Date</option>
                        <option value="title" {% if filters.sort_by == 'title' %}selected{% endif %}>Sort by Title</option>
                        <option value="views" {% if filters.sort_by == 'views' %}selected{% endif %}>Sort by Views</option>
                    </select>
                    <select id="sort-order" class="filter-select">
                        <option value="desc" {% if filters.sort_order == 'desc' %}selected{% endif %}>Newest First</option>
                        <option value="asc" {% if filters.sort_order == 'asc' %}selected{% endif %}>Oldest First</option>
                    </select>
                    <select id="filter-kept" class="filter-select">
                        <option value="" {% if filters.filter_kept == '' %}selected{% endif %}>All Videos</option>
                        <option value="true"
                                {% if filters.filter_kept == 'true' %}selected{% endif %}>Kept Videos Only</option>
                        <option value="false"
                                {% if filters.filter_kept == 'false' %}selected{% endif %}>
                            Non-Kept Videos Only
                        </option>
                    </select>
                    <label class="checkbox-label">
                        <input type="checkbox"
                               id="include-shorts"
                               {% if filters.include_shorts %}checked{% endif %}>
                        Include Shorts
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox"
                               id="include-deleted"
                               {% if filters.include_deleted %}checked{% endif %}>
                        Show Deleted Videos
                    </label>
                </div>
            </div>
        </div>
        <div class="grid-container">
            {% for row in data[0] %}
                <div class="card{% if row['is_deleted'] %} deleted-video{% endif %}">
                    <a href="video/{{ row['id'] }}">
                        <div class="center-div-video">
                            <div style="background-size: cover;
                                        background-position: center;
                                        background-image: url('{{ row['thumb_path'] }}');
                                        position: relative{% if row['is_deleted'] %}; opacity: 0.6{% endif %}">
                                {% if loop.index <= 9 %}<div class="video-number">{{ loop.index }}</div>{% endif %}
                                <div class="video-duration" style="left: 10px;{% if row['is_deleted'] %} background-color: #cc0000; color: white;{% endif %}">{{ row['size'] }}</div>
                                {% if row['is_deleted'] %}
                                    <div class="deleted-indicator" style="position: absolute; top: 5px; right: 5px; background: #cc0000; color: white; padding: 2px 6px; font-size: 10px; border-radius: 3px; font-weight: bold;">DELETED</div>
                                {% endif %}
                                <div class="progress-bar">
                                    <div class="progress-fill"
                                         style="width: {{ row['progress_percentage'] }}%"></div>
                                </div>
                            </div>
                        </div>
                    </a>
                    <div class="content">
                        <div class="center-div-title">
                            <h3>{{ row['title'] }}</h3>
                        </div>
                        <div class="center-div">
                            <p class="channel_name">
                                <a class="channel_a" href="channel/{{ row['channel'] }}">{{ row['channel'] }}</a>
                            </p>
                            <p class="views">{{ row['views'] }} views</p>
                        </div>
                    </div>
                </div>
            {% endfor %}
            <div id="myModal" class="modal">
                <div class="modal-content">
                    <span class="close">&times;</span>
                    <form id="channel_form">
                        <label for="channel_input" style="color:white;">Channel URL, ID, or @handle:</label>
                        <input type="text"
                               id="channel_input"
                               name="channel_input"
                               placeholder="https://youtube.com/c/channelname or UCxxxxxxx or @username">
                        <br>
                        <br>
                        <button type="button" id="preview_btn">Preview Channel</button>
                        <br>
                        <br>
                        <div id="channel_preview" style="display:none;">
                            <h3 style="color:white;">Channel Preview</h3>
                            <div id="preview_content"></div>
                            <br>
                            <button type="button" id="confirm_add_btn" style="display:none;">Add This Channel</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <div style="padding-top: 15px;"></div>
        {% include 'pagination.html' %}
        <script src="../static/add_channel_modal.js"></script>
        <script src="../static/refresh_rss.js"></script>
        <script src="../static/keyboard_controls.js"></script>
        <script src="../static/hamburger_menu.js"></script>
        <script src="../static/video_filters.js"></script>
        <script src="../static/mobile_filter_toggle.js"></script>
    </body>
</html>
